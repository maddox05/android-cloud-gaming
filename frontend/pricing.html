<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MaddoxCloud | Pricing</title>
  <link rel="icon" type="image/png" href="imgs/favicon.png">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <a href="/" class="logo">
        <img src="imgs/favicon.png" alt="" class="logo-icon">
        MaddoxCloud
      </a>
    </div>

    <div class="header-right">
      <a href="/" class="nav-link">Home</a>

      <!-- Auth UI -->
      <button id="login-btn" class="login-btn" onclick="signInWithGoogle()">Sign In</button>
      <div id="user-info" class="user-info" style="display: none;">
        <span id="user-name" class="user-name"></span>
        <a href="https://billing.stripe.com/p/login/4gMeVdfY5c553jheYeew800" class="settings-btn" title="Manage Subscription">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
          </svg>
        </a>
        <button class="logout-btn" onclick="signOut()">Sign Out</button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="pricing-page">
    <div class="pricing-header">
      <h1>Choose Your Plan</h1>
      <p>Unlock premium cloud gaming with faster streaming and priority access.</p>
    </div>

    <div class="pricing-container" id="pricing-container">
      <div class="pricing-cards">
        <!-- Monthly Plan -->
        <div class="pricing-card">
          <div class="pricing-card-header">
            <span class="pricing-badge">Early Access</span>
            <h2 class="pricing-plan-name">Monthly</h2>
            <div class="pricing-price">
              <span class="pricing-amount">$30</span>
              <span class="pricing-period">/month</span>
            </div>
          </div>
          <ul class="pricing-perks">
            <li>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              Early Server Access
            </li>
            <li>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              Priority Queue (0 min wait)
            </li>
            <li>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              Proxy Links Made Weekly
            </li>
            <li>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              Early Access Perks (Discord Badges, Discounts, Events and more!)
            </li>
          </ul>
          <a href="https://buy.stripe.com/4gMeVdfY5c553jheYeew800" class="pricing-cta">Get Started</a>
        </div>

        <!-- Lifetime Plan -->
        <div class="pricing-card pricing-card-featured">
          <div class="pricing-card-header">
            <span class="pricing-badge pricing-badge-featured">Best Value</span>
            <h2 class="pricing-plan-name">Lifetime</h2>
            <div class="pricing-price">
              <span class="pricing-amount">$200</span>
              <span class="pricing-period">one-time</span>
            </div>
            <div class="pricing-urgency">Only 19 left!</div>
          </div>
          <ul class="pricing-perks">
            <li>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              Everything in Monthly
            </li>
            
            <li>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              Lifetime access forever
            </li>
          </ul>
          <a href="https://buy.stripe.com/3cI8wP9zH7OP4nlcQ6ew801" class="pricing-cta pricing-cta-featured">Get Lifetime Access</a>
        </div>
      </div>
    </div>
  </main>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="config.js"></script>
  <script src="js/auth.js"></script>
  <script>
    const MONTHLY_URL = 'https://buy.stripe.com/4gMeVdfY5c553jheYeew800';
    const LIFETIME_URL = 'https://buy.stripe.com/3cI8wP9zH7OP4nlcQ6ew801';

    // Update checkout links with user info
    function updateCheckoutLinks(user) {
      const links = document.querySelectorAll('.pricing-cta');

      if (!user) {
        // Reset to base URLs and intercept clicks
        links.forEach((link, index) => {
          link.href = index === 0 ? MONTHLY_URL : LIFETIME_URL;
          link.onclick = (e) => {
            e.preventDefault();
            signInWithGoogle();
          };
        });
        return;
      }

      // Add client_reference_id and prefilled_email to checkout URLs
      links.forEach((link, index) => {
        const baseUrl = index === 0 ? MONTHLY_URL : LIFETIME_URL;
        const url = new URL(baseUrl);
        url.searchParams.set('client_reference_id', user.id);
        if (user.email) {
          url.searchParams.set('prefilled_email', user.email);
          url.searchParams.set('customer_email', user.email);
                    url.searchParams.set('email', user.email);

        }
        link.href = url.toString();
        link.onclick = null; // Remove click interceptor
        console.log('Updated checkout link:', link.href);
      });
    }

    // Wait for auth to be ready
    document.addEventListener('DOMContentLoaded', async function() {
      // Initial check after a delay for auth to initialize
      setTimeout(async () => {
        const user = await window.getCurrentUser();
        updateCheckoutLinks(user);
      }, 500);

      // Also listen for auth state changes via polling
      let lastUserId = null;
      setInterval(async () => {
        const user = await window.getCurrentUser();
        const currentId = user?.id || null;
        if (currentId !== lastUserId) {
          lastUserId = currentId;
          updateCheckoutLinks(user);
        }
      }, 1000);
    });
  </script>
</body>
</html>
